- builder:
    name: deploy
    builders:
      - shell: |
          #!/bin/bash
          set -v
          set +e
          docker kill jjb
          docker rm jjb
          docker rmi rdpa/jenkins-job-builder
          set -e
          docker build -t rdpa/jenkins-job-builder docker/jenkins-job-builder/.
          docker run -d --name jjb rdpa/jenkins-job-builder

- job:
    name: 'Build and Deploy Docker JJB Image'
    project-type: freestyle
    defaults: global
    scm:
      - git:
          url: https://github.com/rdpa/docker-jenkins-job-builder.git
          branches:
            - master
    triggers:
      - github
      - pollscm
    builders:
      - deploy

- job:
    name: 'Canary Test'
    project-type: freestyle
    defaults: global
